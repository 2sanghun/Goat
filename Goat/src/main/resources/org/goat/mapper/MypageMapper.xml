<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- namespace로 TestMapper와 연결 -->

<mapper namespace="org.goat.mapper.MypageMapper">

	<update id="modify">
		update member 
		set name = #{name}, password= #{password}, email=#{email}, addr=#{addr}
		where id=#{id}
	</update>

	<delete id="remove">
		delete from member
		where password=#{password} and id=#{id};
	</delete>
	<select id="removechk" resultType="int">
		select count(*) from member
		where password=#{password} and id=#{id};
	</select>

	<select id="my" resultType="org.goat.model.MemberVO">
		select * from member;

	</select>

	<!-- replace(email,',','') 이메일에 콤마를 없앤다 -->
	<select id="detail" resultType="org.goat.model.MemberVO">
		select id,name,password,replace(email,',','') as email,addr from member
		where id=#{id};
	</select>

	<select id="myboard" resultType="org.goat.model.BoardVO">
		select *
		from(
		select @rownum:=@rownum+1 rownum, b.*
		from board b,(select @rownum:=0) as tmp
		where id = #{id}
		<if test="keyword !=null">
			<choose>
				<when test="type == 'T'.toString()">
					and title like concat('%',#{keyword},'%')
				</when>
				<when test="type == 'W'.toString()">
					and id like concat('%',#{keyword},'%')
				</when>
				<otherwise>
					and title like concat('%',#{keyword},'%')
					or content like concat('%',#{keyword},'%')
				</otherwise>
			</choose>

		</if>
		order by bno desc
		) as boardlist 
      <![CDATA[
     where rownum > (#{pageNum}-1)*#{amount} and rownum <= #{pageNum}*#{amount};
     ]]>
	</select>

	<select id="total" resultType="int">
		select count(*) from board
		where id = #{id}
		<if test="keyword !=null">
			<choose>
				<when test="type == 'T'.toString()">
					and title like concat('%',#{keyword},'%')
				</when>
				<when test="type == 'W'.toString()">
					and id like concat('%',#{keyword},'%')
				</when>
				<otherwise>
					and title like concat('%',#{keyword},'%')
					or content like concat('%',#{keyword},'%')
				</otherwise>
			</choose>
		</if>
	</select>
</mapper>
